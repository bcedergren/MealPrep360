# External API Mode Setup

This guide explains how to configure the MealPrep360 API to run in external API mode, which disables internal microservices and focuses on the core API functionality.

## Quick Fix for Health Check Issues

If you're seeing "Invalid service configuration" errors in your health check, you can fix this by enabling external API mode.

## Environment Variables

Add this environment variable to your `.env` file or deployment configuration:

```env
USE_EXTERNAL_API_ONLY=true
```

## What This Does

When `USE_EXTERNAL_API_ONLY=true` is set:

1. **Disables Internal Services**: All internal microservices (recipe-service, mealplan-service, etc.) are disabled
2. **Skips Service Validation**: The health check won't validate internal service configurations
3. **Focuses on Core API**: Only the main API endpoints and external integrations are active
4. **External Shopping Lists**: Shopping lists are always generated by the external service at shopping.mealprep360.com
5. **Simplifies Health Checks**: Health checks focus on database, external APIs, and system resources

## Health Check Response

With external API mode enabled, your health check will return:

```json
{
  "status": "healthy",
  "timestamp": "2025-07-21T14:31:49.253Z",
  "uptime": 6928.252020486,
  "environment": "production",
  "version": "1.0.0",
  "mode": "external-api-only",
  "system": {
    "overall": "healthy",
    "services": [],
    "metrics": { ... },
    "circuitBreakers": { ... }
  },
  "services": [],
  "checks": {
    "database": { "status": "healthy", "responseTime": 45 },
    "external_apis": { "status": "healthy", "details": [...] },
    "memory": { "status": "healthy", "usage": { ... } },
    "disk": { "status": "healthy", "details": { ... } }
  }
}
```

## Deployment Configuration

### Vercel

1. Go to your Vercel project dashboard
2. Navigate to Settings â†’ Environment Variables
3. Add: `USE_EXTERNAL_API_ONLY` = `true`
4. Deploy the changes

### Other Platforms

Add the environment variable through your hosting platform's configuration interface.

## Benefits

- **Simplified Configuration**: No need to configure internal microservices
- **Reduced Complexity**: Fewer moving parts and potential failure points
- **Faster Startup**: No internal service validation during initialization
- **Cleaner Health Checks**: Focus on essential system health metrics

## Required Environment Variables

Even in external API mode, you still need these core environment variables:

```env
# Database
MONGODB_URI=your_mongodb_connection_string

# Authentication
CLERK_SECRET_KEY=your_clerk_secret_key
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=your_clerk_publishable_key

# External APIs
OPENAI_API_KEY=your_openai_api_key

# Optional
NODE_ENV=production
API_VERSION=1.0.0
```

## Testing

After setting the environment variable, test your health endpoint:

```bash
curl https://api.mealprep360.com/api/health
```

You should see a healthy response with `"mode": "external-api-only"`.

## Troubleshooting

If you still see health check issues:

1. **Check Environment Variables**: Ensure `USE_EXTERNAL_API_ONLY=true` is set
2. **Restart Application**: Restart your application after adding the environment variable
3. **Check Logs**: Look for "External API mode detected" in your application logs
4. **Database Connection**: Ensure your MongoDB connection is working

## Reverting to Full Service Mode

To re-enable internal services, simply remove or set `USE_EXTERNAL_API_ONLY=false`:

```env
USE_EXTERNAL_API_ONLY=false
```

Note: You'll need to configure all the internal service API keys and URLs if you want to use full service mode.
